(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{1950:function(e,t,o){Promise.resolve().then(o.bind(o,610)),Promise.resolve().then(o.t.bind(o,2801,23))},610:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return AuthProvider}});var i=o(7437),r=o(2265),n=o(9594);function AuthProvider(e){let{children:t}=e,{initialize:o,isInitialized:a}=(0,n.a)();return(0,r.useEffect)(()=>{a||o()},[o,a]),(0,i.jsx)(i.Fragment,{children:t})}},9594:function(e,t,o){"use strict";o.d(t,{a:function(){return a}});var i=o(4660),r=o(4829);let n=r.Z.create({headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),n.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let a=(0,i.Ue)((e,t)=>({user:null,token:null,isAuthenticated:!1,isLoading:!0,isInitialized:!1,error:null,login:async(t,o)=>{try{e({isLoading:!0,error:null});let i=await n.post("/api/auth/login",{username_or_email:t,password:o}),{access_token:r,user:a}=i.data;localStorage.setItem("token",r),localStorage.setItem("user",JSON.stringify(a)),e({user:a,token:r,isAuthenticated:!0,isLoading:!1})}catch(t){var i,r,a,l;throw e({error:(null===(r=t.response)||void 0===r?void 0:null===(i=r.data)||void 0===i?void 0:i.message)||(null===(l=t.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.error)||"Login failed",isLoading:!1}),t}},register:async t=>{try{e({isLoading:!0,error:null});let o=await n.post("/api/auth/register",t),{access_token:i,user:r}=o.data;localStorage.setItem("token",i),localStorage.setItem("user",JSON.stringify(r)),e({user:r,token:i,isAuthenticated:!0,isLoading:!1})}catch(n){var o,i,r,a;let t=(null===(i=n.response)||void 0===i?void 0:null===(o=i.data)||void 0===o?void 0:o.message)||(null===(a=n.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.error)||"Registration failed";throw e({error:t,isLoading:!1}),n}},logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),e({user:null,token:null,isAuthenticated:!1}),window.location.href="/auth/login"},clearError:()=>e({error:null}),initialize:()=>{{let t=localStorage.getItem("token"),o=localStorage.getItem("user");if(t&&o)try{let i=JSON.parse(o);e({token:t,user:i,isAuthenticated:!0,isLoading:!1,isInitialized:!0})}catch(t){localStorage.removeItem("token"),localStorage.removeItem("user"),e({isLoading:!1,isInitialized:!0})}else e({isLoading:!1,isInitialized:!0})}}}));a.getState().initialize()},2801:function(){}},function(e){e.O(0,[57,971,472,744],function(){return e(e.s=1950)}),_N_E=e.O()}]);