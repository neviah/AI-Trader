"use strict";(()=>{var e={};e.id=1218,e.ids=[1218],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5487:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>u,originalPathname:()=>A,requestAsyncStorage:()=>l,routeModule:()=>n,serverHooks:()=>d,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>p});var a={};r.r(a),r.d(a,{GET:()=>GET,POST:()=>POST});var s=r(884),o=r(6132),i=r(5798);let AITrader=class AITrader{constructor(e,t,r=!0){this.apiKey=e,this.secretKey=t,this.paperTrading=r,this.baseUrl=r?"https://paper-api.alpaca.markets":"https://api.alpaca.markets"}async getMarketData(e){try{let t=await fetch(`${this.baseUrl}/v2/stocks/${e}/bars?timeframe=1Day&limit=10`,{headers:{"APCA-API-KEY-ID":this.apiKey,"APCA-API-SECRET-KEY":this.secretKey}});if(!t.ok)throw Error(`Failed to get market data for ${e}`);return await t.json()}catch(t){return console.error(`Error getting market data for ${e}:`,t),null}}analyzeTrend(e){if(!e||e.length<3)return"hold";let t=e.slice(-3),r=t.map(e=>parseFloat(e.c));return r[2]>r[1]&&r[1]>r[0]?"buy":r[2]<r[1]&&r[1]<r[0]?"sell":"hold"}async executeTrade(e,t,r=1){try{let a=await fetch(`${this.baseUrl}/v2/orders`,{method:"POST",headers:{"APCA-API-KEY-ID":this.apiKey,"APCA-API-SECRET-KEY":this.secretKey,"Content-Type":"application/json"},body:JSON.stringify({symbol:e.toUpperCase(),qty:r,side:t,type:"market",time_in_force:"gtc"})});if(!a.ok)throw Error(`Failed to execute ${t} order for ${e}`);return await a.json()}catch(t){throw console.error(`Error executing trade for ${e}:`,t),t}}async getCurrentPositions(){try{let e=await fetch(`${this.baseUrl}/v2/positions`,{headers:{"APCA-API-KEY-ID":this.apiKey,"APCA-API-SECRET-KEY":this.secretKey}});if(!e.ok)throw Error("Failed to get current positions");return await e.json()}catch(e){return console.error("Error getting positions:",e),[]}}async makeTradeDecision(e){try{let t=await this.getMarketData(e);if(!t?.bars)return{symbol:e,action:"hold",reasoning:"No market data available",confidence:0};let r=this.analyzeTrend(t.bars),a=parseFloat(t.bars[t.bars.length-1]?.c||"0"),s="",o=.6;"buy"===r?(s=`Upward momentum detected. Recent prices show consistent increase. Latest: $${a}`,o=.7):"sell"===r?(s=`Downward trend detected. Recent prices show consistent decrease. Latest: $${a}`,o=.7):(s=`Market shows sideways movement. Holding position. Latest: $${a}`,o=.5);let i=null;if("buy"===r||"sell"===r)try{let t=await this.getCurrentPositions(),a=t.find(t=>t.symbol===e);if("buy"===r&&a)return s+=" (Already have position, skipping buy)",{symbol:e,action:"hold",reasoning:s,confidence:.3};if("sell"===r&&!a)return s+=" (No position to sell, skipping)",{symbol:e,action:"hold",reasoning:s,confidence:.3};i=await this.executeTrade(e,r,1),s+=` Trade executed: ${r} 1 share`}catch(e){s+=` Trade failed: ${e}`,o=.2}return{symbol:e,action:r,reasoning:s,confidence:o,order:i}}catch(t){return{symbol:e,action:"hold",reasoning:`Analysis failed: ${t}`,confidence:0}}}};async function POST(e){try{let{symbols:t,mode:r}=await e.json(),a=process.env.ALPACA_API_KEY,s=process.env.ALPACA_SECRET_KEY,o="true"===process.env.ALPACA_PAPER_TRADING;if(!a||!s)return i.Z.json({error:"Alpaca API credentials not configured"},{status:500});let n=new AITrader(a,s,o),l=t||["AAPL","GOOGL","MSFT","TSLA","NVDA"];console.log(`ðŸ¤– AI Trader analyzing ${l.length} stocks...`);let c=[];for(let e of l){console.log(`ðŸ“Š Analyzing ${e}...`);let t=await n.makeTradeDecision(e);c.push(t),await new Promise(e=>setTimeout(e,500))}let d={totalAnalyzed:c.length,buySignals:c.filter(e=>"buy"===e.action).length,sellSignals:c.filter(e=>"sell"===e.action).length,holdSignals:c.filter(e=>"hold"===e.action).length,averageConfidence:c.reduce((e,t)=>e+t.confidence,0)/c.length,executedTrades:c.filter(e=>e.order).length};return console.log("\uD83C\uDFAF AI Trading Analysis Complete:",d),i.Z.json({success:!0,timestamp:new Date().toISOString(),mode:r||"analysis",paperTrading:o,summary:d,decisions:c})}catch(e){return console.error("âŒ AI Trader error:",e),i.Z.json({error:"AI Trading analysis failed",details:e.message},{status:500})}}async function GET(){try{let e=process.env.ALPACA_API_KEY,t=process.env.ALPACA_SECRET_KEY,r="true"===process.env.ALPACA_PAPER_TRADING;if(!e||!t)return i.Z.json({error:"Alpaca API credentials not configured"},{status:500});let a=new AITrader(e,t,r),s=await a.getCurrentPositions();return i.Z.json({success:!0,paperTrading:r,positions:s.map(e=>({symbol:e.symbol,quantity:parseFloat(e.qty),marketValue:parseFloat(e.market_value),costBasis:parseFloat(e.cost_basis),unrealizedPnl:parseFloat(e.unrealized_pl),side:e.side})),timestamp:new Date().toISOString()})}catch(e){return console.error("âŒ AI Trader positions error:",e),i.Z.json({error:"Failed to get AI trader positions",details:e.message},{status:500})}}let n=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/ai-trader/route",pathname:"/api/ai-trader",filename:"route",bundlePath:"app/api/ai-trader/route"},resolvedPagePath:"/workspaces/AI-Trader/frontend/app/api/ai-trader/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:d,headerHooks:u,staticGenerationBailout:p}=n,A="/api/ai-trader/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[1997],()=>__webpack_exec__(5487));module.exports=r})();